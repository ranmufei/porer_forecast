# 项目结构说明

## 📁 清理后的项目结构

```
power_forecast2.0/
├── 📂 核心文件
│   ├── train_power_forecast_optimized.py    # 优化模型训练脚本（主脚本）
│   ├── predict_power_optimized.py           # 优化模型预测脚本
│   ├── api.py                               # RESTful API服务
│   └── requirements.txt                     # Python依赖包
│
├── 📂 数据文件
│   ├── data_gfs_forecast.csv                # GFS气象预报数据（1.0MB）
│   └── data_history_power.csv               # 历史功率数据（943KB）
│
├── 📂 模型文件（优化模型）
│   ├── power_forecast_model_optimized_xgboost.pkl              # XGBoost模型（2.2MB）
│   ├── power_forecast_model_optimized_random_forest.pkl       # 随机森林模型（8.2MB）
│   ├── power_forecast_model_optimized_gradient_boosting.pkl   # 梯度提升模型（927KB）
│   └── power_forecast_model_optimized_info.pkl                # 模型元信息（74B）
│
├── 📂 预测结果
│   ├── predictions_optimized.csv            # 优化模型预测结果（25KB）
│   ├── prediction_results_optimized.png     # 预测结果对比图（361KB）
│   └── feature_importance_optimized.png     # 特征重要性图（204KB）
│
├── 📂 文档
│   ├── README.md                            # 项目说明
│   ├── CLAUDE.md                            # Claude Code使用指南
│   ├── 项目总结报告.md                      # 项目总体报告
│   ├── 优化报告.md                          # 优化模型详细报告
│   └── 分层模型失败分析报告.md              # 分层模型失败原因分析
│
└── 📂 archive/                              # 归档目录（不再使用的文件）
    ├── hierarchical_models/                 # 分层模型相关文件（已废弃）
    │   ├── train_hierarchical_model.py
    │   ├── predict_hierarchical.py
    │   ├── *.pkl（分层模型文件）
    │   └── *.png、*.csv（分层模型结果）
    │
    ├── basic_models/                        # 基础模型相关文件（已废弃）
    │   ├── train_power_forecast.py
    │   ├── predict_power.py
    │   ├── power_forecast_model.pkl
    │   └── *.png（基础模型结果）
    │
    └── analysis_files/                      # 临时分析文件
        ├── analyze_power_segments.py
        ├── analyze_final_comparison.py
        ├── test_optimization.py
        ├── *.csv（分析统计数据）
        ├── *.png（对比图表）
        └── 对比数据/（历史对比数据）
```

---

## 🎯 核心工作流程

### 1. 训练模型

```bash
# 使用优化模型架构训练（包含温度高级特征）
python train_power_forecast_optimized.py
```

**输出**：
- `power_forecast_model_optimized_*.pkl` - 集成模型的3个基学习器
- `power_forecast_model_optimized_info.pkl` - 模型信息和温度统计量
- `prediction_results_optimized.png` - 训练过程可视化
- `feature_importance_optimized.png` - 特征重要性

**最新性能**（2025-01-16 更新）：
- MAE: 5,786.6 kW（改进11.2%）
- RMSE: 7,619.9 kW（改进10.1%）
- R²: 0.69（提升32.7%）
- 特征数量：26个（新增8个温度特征）

### 2. 功率预测

```bash
# 使用训练好的优化模型进行预测
python predict_power_optimized.py
```

**输出**：
- `predictions_optimized.csv` - 预测结果

### 3. API服务

```bash
# 启动RESTful API服务
python api.py
```

**服务地址**：http://localhost:5000

**主要接口**：
- `POST /predict` - 单点功率预测
- `POST /batch_predict` - 批量功率预测
- `GET /health` - 健康检查
- `GET /info` - API信息

---

## 📊 模型性能

**优化模型 v2.1（当前使用，2025-01-16更新）**：

| 指标 | 数值 | 改进幅度 |
|------|------|---------|
| MAE | **5,786.6 kW** | ↓ 11.2% |
| RMSE | **7,619.9 kW** | ↓ 10.1% |
| MAPE | 164.9% | - |
| R² | **0.69** | ↑ 32.7% |

**集成策略**：
- XGBoost（权重50%）- 主力模型
- Random Forest（权重30%）- 降低方差
- Gradient Boosting（权重20%）- 补充模型

**特征数量**：26个（包括8个温度高级特征）

---

## ⚠️ 重要说明

### 已废弃的方案

以下方案因性能不佳已被废弃，相关文件已移至 `archive/` 目录：

1. **基础模型 v1.0** (`archive/basic_models/`)
   - 单一XGBoost模型，无温度高级特征
   - 性能：MAE=7,178 kW

2. **优化模型 v2.0** (已升级到v2.1)
   - 性能：MAE=6,518.7 kW
   - 改进：添加8个温度高级特征 → MAE=5,786.6 kW

3. **分层+物理约束模型** (`archive/hierarchical_models/`)
   - 5个功率段分层建模
   - 性能：MAE=20,559 kW（性能恶化215%）
   - 失败原因详见：[`分层模型失败分析报告.md`](分层模型失败分析报告.md)

### 版本历史

| 版本 | 日期 | MAE (kW) | 主要改进 |
|------|------|---------|---------|
| v1.0 基础模型 | 2025-01-05 | 7,178.0 | 初始版本 |
| v2.0 优化模型 | 2025-01-15 | 6,518.7 | 集成学习 + 物理约束特征 |
| **v2.1 温度增强** | **2025-01-16** | **5,786.6** | **添加8个温度高级特征** |

---

## 🔄 文件清理记录

**清理日期**：2025年1月16日

**清理原则**：
1. ✅ 保留优化模型相关的所有文件
2. ✅ 保留核心数据文件
3. ✅ 保留API服务文件
4. ✅ 保留项目文档和报告
5. ❌ 归档基础模型文件（性能不佳）
6. ❌ 归档分层模型文件（性能恶化）
7. ❌ 归档临时分析文件（仅供历史参考）

**归档目录说明**：
- `archive/hierarchical_models/` - 分层模型实验失败，保留用于历史参考
- `archive/basic_models/` - 基础模型已被优化模型替代
- `archive/analysis_files/` - 临时分析脚本和结果，不再需要

**注意**：归档文件**不会影响项目的正常运行**，所有核心功能均使用优化模型实现。

---

## 📝 快速参考

### 常用命令

```bash
# 1. 训练模型
python train_power_forecast_optimized.py

# 2. 进行预测
python predict_power_optimized.py

# 3. 启动API服务
python api.py

# 4. 查看预测结果
head -n 10 predictions_optimized.csv

# 5. Python快速查看
python -c "import pandas as pd; df = pd.read_csv('predictions_optimized.csv'); print(df.head(10))"
```

### 数据格式

**GFS气象数据** (`data_gfs_forecast.csv`):
```
timestamp,gfs_temp,gfs_wind_speed,gfs_wind_direction
2024-08-01 00:00:00,15.5,8.3,180
2024-08-01 00:15:00,15.3,8.5,182
...
```

**预测结果** (`predictions_optimized.csv`):
```
timestamp,predicted_power
2024-08-01 00:00:00,12345.67
2024-08-01 00:15:00,12890.23
...
```

---

## 🚀 下一步建议

1. **数据收集**：收集更多极端天气条件下的数据
2. **模型优化**：尝试深度学习模型（LSTM、Transformer）
3. **不确定性量化**：实现预测置信区间
4. **在线学习**：实时模型更新机制

---

**项目维护**：Claude Code
**最后更新**：2025年1月16日
**当前版本**：v2.0（优化模型）
